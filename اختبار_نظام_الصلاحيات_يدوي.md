# قائمة الاختبار اليدوي لنظام الصلاحيات

## الهدف
التحقق من أن نظام الصلاحيات يعمل بشكل صحيح من البداية للنهاية عبر واجهة المستخدم.

---

## المتطلبات الأساسية

قبل البدء، تأكد من توفر:
- ✅ حساب **مدير عام** (GENERAL_ADMIN) للاختبار
- ✅ حساب **مسؤول مشروع** (PROJECT_MANAGER) للاختبار
- ✅ مشروع واحد على الأقل في النظام
- ✅ الخادم يعمل بدون أخطاء

---

## السيناريو 1: إعطاء صلاحيات جديدة

### الخطوات:

#### 1. تسجيل الدخول كمدير عام
- [ ] افتح الموقع
- [ ] سجل الدخول بحساب مدير عام
- [ ] تأكد من ظهور لوحة التحكم بشكل صحيح

#### 2. الوصول إلى صفحة الصلاحيات الشاملة
- [ ] من القائمة العلوية، اختر **"إدارة"**
- [ ] اختر **"إدارة الصلاحيات الشاملة"**
- [ ] تأكد من فتح الصفحة بدون أخطاء
- [ ] يجب أن ترى 3 خطوات: (1) اختر المشروع (2) اختر المستخدم (3) إدارة الصلاحيات

#### 3. اختيار المشروع
- [ ] اختر مشروع من القائمة المنسدلة
- [ ] اضغط زر **"التالي"**
- [ ] تأكد من الانتقال للخطوة الثانية

#### 4. اختيار المستخدم
- [ ] يجب أن ترى قائمة بالمستخدمين في المشروع
- [ ] اختر مستخدم (PROJECT_MANAGER أو HANDLER)
- [ ] اضغط زر **"التالي"**
- [ ] تأكد من الانتقال للخطوة الثالثة

#### 5. إدارة الصلاحيات
- [ ] يجب أن ترى جدول كبير بجميع الصلاحيات
- [ ] الصلاحيات منظمة حسب الأقسام (Dogs, Employees, Training, etc.)
- [ ] كل صلاحية لها 5 أنواع على الأقل (VIEW, CREATE, EDIT, DELETE, EXPORT)

#### 6. تفعيل صلاحيات جديدة
- [ ] اختر قسم **"الكلاب (Dogs)"**
- [ ] فعّل الصلاحيات التالية بالضغط على المربعات:
  - [ ] Dogs → VIEW (عرض)
  - [ ] Dogs → EDIT (تعديل)
- [ ] يجب أن تتحول المربعات إلى اللون الأخضر ✅
- [ ] تأكد من ظهور علامة الصح داخل المربع

#### 7. حفظ التغييرات
- [ ] اضغط زر **"حفظ التغييرات"** في أسفل الصفحة
- [ ] يجب أن تظهر رسالة نجاح: **"تم حفظ جميع التغييرات بنجاح"**
- [ ] الرسالة باللون الأخضر
- [ ] لا توجد رسائل خطأ حمراء

---

## السيناريو 2: التحقق من حفظ الصلاحيات في قاعدة البيانات

### الخطوات:

#### 1. إعادة فتح نفس الصفحة
- [ ] ابق في صفحة الصلاحيات الشاملة
- [ ] ارجع للخطوة الأولى (اختر المشروع)
- [ ] اختر **نفس المشروع** الذي استخدمته سابقاً
- [ ] اختر **نفس المستخدم**
- [ ] افتح صفحة إدارة الصلاحيات

#### 2. التحقق من الصلاحيات المحفوظة
- [ ] ابحث عن قسم **"الكلاب (Dogs)"**
- [ ] يجب أن تكون الصلاحيات التي فعّلتها سابقاً **ما زالت مفعّلة** ✅:
  - [ ] Dogs → VIEW (باللون الأخضر)
  - [ ] Dogs → EDIT (باللون الأخضر)
- [ ] إذا كانت المربعات خضراء = النظام يحفظ بشكل صحيح ✅
- [ ] إذا كانت المربعات رمادية = هناك مشكلة ❌

---

## السيناريو 3: اختبار تطبيق الصلاحيات على المستخدم

### الخطوات:

#### 1. تسجيل الخروج من حساب المدير العام
- [ ] اضغط زر تسجيل الخروج
- [ ] تأكد من الرجوع لصفحة تسجيل الدخول

#### 2. تسجيل الدخول بحساب المستخدم الذي منحته صلاحيات
- [ ] سجل الدخول بحساب المستخدم (PROJECT_MANAGER أو HANDLER)
- [ ] يجب أن تفتح لوحة التحكم الخاصة به

#### 3. التحقق من ظهور الأقسام في القائمة
- [ ] افتح القائمة الجانبية أو العلوية
- [ ] يجب أن ترى قسم **"الكلاب"** أو **"Dogs"** (لأنك منحته VIEW)
- [ ] إذا كان المستخدم يرى القسم = الصلاحيات تعمل ✅
- [ ] إذا لم يكن يرى القسم = هناك مشكلة ❌

#### 4. التحقق من الوصول إلى صفحة الكلاب
- [ ] اضغط على قسم **"الكلاب"**
- [ ] يجب أن تفتح صفحة قائمة الكلاب بدون أخطاء
- [ ] يجب أن يرى المستخدم جدول الكلاب (لديه VIEW)

#### 5. التحقق من صلاحية التعديل
- [ ] ابحث عن زر **"تعديل"** بجانب أي كلب
- [ ] يجب أن يكون الزر ظاهراً وقابلاً للضغط (لديه EDIT)
- [ ] اضغط على زر التعديل
- [ ] يجب أن تفتح صفحة التعديل بدون رسالة "غير مصرح" ✅

#### 6. التحقق من عدم وجود صلاحية الحذف
- [ ] ابحث عن زر **"حذف"** بجانب أي كلب
- [ ] يجب **ألا يظهر** زر الحذف (لم نعطه صلاحية DELETE)
- [ ] إذا كان الزر مخفي = الصلاحيات تعمل بشكل صحيح ✅
- [ ] إذا كان الزر ظاهر = هناك مشكلة ❌

---

## السيناريو 4: إلغاء صلاحيات

### الخطوات:

#### 1. تسجيل الخروج والدخول كمدير عام مرة أخرى
- [ ] سجل الخروج من حساب المستخدم
- [ ] سجل الدخول بحساب المدير العام

#### 2. فتح صفحة الصلاحيات الشاملة
- [ ] إدارة → إدارة الصلاحيات الشاملة
- [ ] اختر نفس المشروع والمستخدم

#### 3. إلغاء صلاحية
- [ ] ابحث عن صلاحية **Dogs → EDIT**
- [ ] اضغط على المربع الأخضر لإلغاء الصلاحية
- [ ] يجب أن يتحول المربع من الأخضر إلى الرمادي ❌
- [ ] علامة الصح يجب أن تختفي

#### 4. حفظ التغييرات
- [ ] اضغط زر **"حفظ التغييرات"**
- [ ] يجب أن تظهر رسالة النجاح

#### 5. التحقق من تطبيق الإلغاء
- [ ] سجل الخروج
- [ ] سجل الدخول بحساب المستخدم مرة أخرى
- [ ] افتح صفحة الكلاب
- [ ] يجب **ألا يظهر** زر التعديل الآن ❌
- [ ] إذا اختفى الزر = الإلغاء يعمل ✅

---

## السيناريو 5: الصلاحيات الخاصة بالمشروع

### الخطوات:

#### 1. التأكد من وجود مشروعين على الأقل
- [ ] إذا كان لديك مشروع واحد فقط، أنشئ مشروع جديد

#### 2. منح صلاحيات لمشروع محدد
- [ ] سجل الدخول كمدير عام
- [ ] افتح صفحة الصلاحيات الشاملة
- [ ] اختر **المشروع الأول**
- [ ] اختر مستخدم
- [ ] فعّل صلاحية **Dogs → VIEW**
- [ ] احفظ التغييرات

#### 3. عدم منح صلاحيات للمشروع الثاني
- [ ] ارجع للخطوة الأولى
- [ ] اختر **المشروع الثاني**
- [ ] اختر **نفس المستخدم**
- [ ] **لا تفعّل** صلاحية Dogs → VIEW
- [ ] (أو تأكد أنها غير مفعّلة)

#### 4. اختبار عزل الصلاحيات حسب المشروع
- [ ] سجل الدخول بحساب المستخدم
- [ ] إذا كان المستخدم في المشروع الأول:
  - [ ] يجب أن يرى قسم الكلاب ✅
- [ ] إذا كان المستخدم في المشروع الثاني:
  - [ ] يجب **ألا يرى** قسم الكلاب ❌
- [ ] هذا يؤكد أن الصلاحيات معزولة حسب المشروع ✅

---

## السيناريو 6: سجل التدقيق

### الخطوات:

#### 1. الوصول إلى سجل تدقيق الصلاحيات
- [ ] سجل الدخول كمدير عام
- [ ] من لوحة الإدارة، ابحث عن **"سجل تدقيق الصلاحيات"**
- [ ] افتح الصفحة

#### 2. التحقق من تسجيل التغييرات
- [ ] يجب أن ترى جدول بجميع التغييرات التي قمت بها
- [ ] كل سطر يجب أن يحتوي على:
  - [ ] اسم المستخدم الذي غيّر الصلاحية (admin_test أو اسمك)
  - [ ] المستخدم المستهدف
  - [ ] اسم الصلاحية (مثل: dogs.view)
  - [ ] القيمة القديمة (مثل: False)
  - [ ] القيمة الجديدة (مثل: True)
  - [ ] التاريخ والوقت
  - [ ] عنوان IP
  - [ ] المتصفح المستخدم

#### 3. التأكد من دقة السجل
- [ ] تأكد من أن جميع التغييرات التي قمت بها مسجلة
- [ ] التواريخ والأوقات صحيحة
- [ ] أسماء المستخدمين صحيحة

---

## قائمة التحقق النهائية

بعد إتمام جميع السيناريوهات أعلاه، يجب أن تتحقق النتائج التالية:

### ✅ ما يجب أن يعمل:
- [x] إعطاء صلاحيات جديدة يحفظها في قاعدة البيانات فعلياً
- [x] الصلاحيات المحفوظة تظهر عند إعادة فتح الصفحة
- [x] المستخدمون يرون فقط الأقسام التي لديهم صلاحية الوصول إليها
- [x] الأزرار (تعديل، حذف، إلخ) تظهر حسب الصلاحيات
- [x] إلغاء الصلاحيات ينعكس فوراً على المستخدم
- [x] الصلاحيات معزولة حسب المشروع
- [x] جميع التغييرات مسجلة في سجل التدقيق

### ❌ ما يجب ألا يحدث:
- [ ] رسائل خطأ عند الحفظ
- [ ] اختفاء الصلاحيات بعد الحفظ وإعادة الفتح
- [ ] ظهور أقسام للمستخدمين بدون صلاحيات
- [ ] ظهور أزرار لمستخدمين بدون الصلاحية المناسبة
- [ ] تطبيق صلاحيات مشروع على مشروع آخر

---

## الإبلاغ عن النتائج

بعد إتمام الاختبار، املأ هذا التقرير:

### نتائج الاختبار:

**السيناريو 1 (إعطاء صلاحيات جديدة):**
- الحالة: [ ] نجح ✅ / [ ] فشل ❌
- ملاحظات: ___________________________________

**السيناريو 2 (التحقق من الحفظ في DB):**
- الحالة: [ ] نجح ✅ / [ ] فشل ❌
- ملاحظات: ___________________________________

**السيناريو 3 (تطبيق الصلاحيات على المستخدم):**
- الحالة: [ ] نجح ✅ / [ ] فشل ❌
- ملاحظات: ___________________________________

**السيناريو 4 (إلغاء صلاحيات):**
- الحالة: [ ] نجح ✅ / [ ] فشل ❌
- ملاحظات: ___________________________________

**السيناريو 5 (العزل حسب المشروع):**
- الحالة: [ ] نجح ✅ / [ ] فشل ❌
- ملاحظات: ___________________________________

**السيناريو 6 (سجل التدقيق):**
- الحالة: [ ] نجح ✅ / [ ] فشل ❌
- ملاحظات: ___________________________________

### التقييم النهائي:
- [ ] النظام يعمل بشكل صحيح 100% ✅
- [ ] هناك مشاكل بسيطة ⚠️
- [ ] هناك مشاكل كبيرة ❌

### ملاحظات إضافية:
_______________________________________________
_______________________________________________
_______________________________________________

---

## نصائح مهمة

1. **إذا فشل أي اختبار:**
   - افتح Developer Tools في المتصفح (F12)
   - افتح تبويب Console
   - ابحث عن رسائل خطأ حمراء
   - أرسل لي نص الخطأ الكامل

2. **إذا لم تظهر الصلاحيات:**
   - تأكد من الضغط على زر "حفظ التغييرات"
   - سجل خروج ودخول مرة أخرى
   - جرب في نافذة Incognito/Private
   - امسح ذاكرة المتصفح (Cache)

3. **لاختبار أفضل:**
   - استخدم مستخدمين حقيقيين مختلفين
   - جرب مشاريع مختلفة
   - جرب أقسام مختلفة (Dogs, Employees, Training, etc.)
   - جرب جميع أنواع الصلاحيات (VIEW, CREATE, EDIT, DELETE, EXPORT)

---

**ملاحظة:** هذا الاختبار يجب أن يأخذ حوالي 15-20 دقيقة. خذ وقتك وتأكد من كل خطوة!
