لدينا مشكلة كبيرة وعميقة في تجربة الصلاحيات (UI Authorization) رغم أن Backend Authorization يعمل جزئيًا.

المشكلة الحالية (كما أراها عمليًا):
- عندما أسجّل دخول بحساب HANDLER (سائس) أعطيته بعض الصلاحيات المحددة فقط.
- أتوقع أن تظهر له فقط الشاشات/القوائم الممنوحة له.
- لكن الواقع:
  1) تظهر له في الشريط الرئيسي وقوائم النظام عناصر غير ممنوحة (مثل “التقارير” وتفرعاتها).
  2) عند الضغط عليها قد ينتقل لبعض الصفحات (مركز التقارير/الإحصائيات) رغم عدم منحه صلاحية ذلك.
  3) أحيانًا لا تظهر صفحة معينة في مكان، لكنها تظهر بعد الدخول لتفرع آخر (عدم اتساق).
  4) عند محاولة فتح بعض الصفحات يظهر “غير مصرح” — وهذا صحيح من ناحية backend، لكن هذا غلط UX:
     لا يجب أن تظهر هذه العناصر أصلاً إذا لم يكن لديه صلاحية.

المطلوب النهائي (سلوك إلزامي):
A) UI يجب أن يكون “Deny-by-default” للمستخدمين غير GENERAL_ADMIN:
- أي قائمة/زر/رابط/مركز/كرت/قسم لا يملكه المستخدم في effective permissions:
  يجب أن يكون مخفي بالكامل (لا يظهر له نهائيًا).
- لا أريد أن يرى المستخدم عناصر ثم عند الضغط يقال له غير مصرح.
- الاستثناء الوحيد: GENERAL_ADMIN يرى كل شيء (أو حسب نظامكم).

B) توحيد مصدر الصلاحية للواجهة:
- كل عناصر الـ navbar/sidebar/home dashboard/cards/reports center/links داخل الصفحات
  يجب أن تعتمد على نفس منطق effective_permissions(user):
  baseline(role) + granted_overrides - revoked_overrides
- ممنوع استخدام role-only checks في بعض الأماكن وeffective in أماكن أخرى (يخلق التناقض الذي أراه).

C) تقارير النظام تحديدًا:
- قائمة “التقارير” وتفرعاتها يجب أن تظهر فقط إذا المستخدم لديه صلاحية reports.view (أو equivalent key).
- وكل تقرير داخل القائمة يجب أن يظهر فقط إذا المستخدم لديه permission الخاص به.
- “مركز التقارير والإحصائيات” يجب ألا يُفتح ولا يُعرض في القائمة إلا لمن لديه صلاحية الوصول له.

D) لا تعتمد فقط على إخفاء قائمة واحدة:
- يجب أن تغطي كل نقاط ظهور الروابط:
  1) الشريط الرئيسي (navbar)
  2) القائمة الجانبية (إن وجدت)
  3) لوحة التحكم (dashboard cards/tiles)
  4) صفحات “مركز التقارير” (reports hub) والقوائم داخله
  5) أي روابط داخل صفحات أخرى تؤدي لنفس الشاشات

E) معايير القبول (Acceptance Criteria):
اختبار 1:
- أنشئ مستخدم HANDLER بصلاحيات قليلة جدًا (مثلاً صلاحية واحدة فقط).
- عند دخوله: لا يرى إلا ما منحته له فقط، والباقي لا يظهر نهائيًا.

اختبار 2:
- امنح HANDLER صلاحية reports.view فقط:
  - يجب أن تظهر قائمة التقارير فقط.
  - لكن داخلها لا يظهر أي تقرير تفصيلي إلا إذا مُنح permission الخاص به.

اختبار 3:
- حاول الوصول عبر UI: يجب ألا يجد روابط للممنوع.
- حاول الوصول عبر URL مباشر: يجب أن يظل backend يمنع (هذا موجود لكن تأكد لا ينكسر).

اختبار 4:
- PM يرى فقط ما له + ما تم منحه override.
- Admin يرى كل شيء.

المخرجات المطلوبة منك:
1) أصلح الـ UI Authorization ليكون إخفاء كامل للأشياء غير المصرح بها.
2) اجعل الواجهة متسقة: نفس منطق الصلاحيات في كل مكان.
3) أعطني شرح مختصر: كيف طبقت gating في (navbar + dashboard + reports center).
4) أعطني خطوات اختبار مرقمة حسب اختبارات 1-4.
