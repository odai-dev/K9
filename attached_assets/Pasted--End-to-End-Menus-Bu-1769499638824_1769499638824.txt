مهمة واحدة مكتملة (End-to-End): جعل نظام الصلاحيات “فعّال” فعليًا في كل مكان:
- الواجهة (Menus / Buttons / Links / Pages)
- الخلفية (Backend route protection)
بالاعتماد على: Role baseline + User overrides (Grant/Revoke)

السياق:
- لدينا أدوار: HANDLER / PROJECT_MANAGER / GENERAL_ADMIN
- لدينا baseline permissions لكل دور
- ولدينا User-specific overrides بنمط 3 حالات لكل Permission:
  Default (اتباع الدور)
  Grant (منح إضافي)
  Revoke (حجب صريح)
- المطلوب أن تكون الصلاحيات “فعليًا” هي التي تحكم كل شيء، وليس مجرد UI أو مجرد Backend.

المطلوب النهائي:
1) تعريف واضح للصلاحية الفعّالة (Effective Permissions)
- يجب أن يكون هناك منطق واحد موحّد في النظام يحسب الصلاحيات الفعالة للمستخدم:
  effective_permissions(user) = baseline(role) + granted_overrides - revoked_overrides
- منطق الـ wildcard إن كان موجودًا للـ GENERAL_ADMIN يجب أن يظل صحيحًا.
- إذا يوجد Scope بالمشروع (Project scope)، لا تكسره.

2) توحيد مصدر القرار في الواجهة (UI Must Follow Effective Permissions)
- أي Menu / Sidebar / Navigation item / Button / Action link داخل أي صفحة:
  يجب أن يظهر أو يختفي بناءً على effective_permissions(user) فقط.
- لا تعتمد على فحص role وحده.
- لا تترك مناطق من النظام ما زالت تعتمد على منطق قديم (مثل role == admin).
- المطلوب أن يتغير UI فورًا عند تغيير overrides:
  المستخدم بعد refresh / logout-login يجب أن يرى التغيير مباشرة.

3) فرض الصلاحيات في الخلفية (Backend Must Enforce Effective Permissions)
- كل routes/endpoints التي تسمح view/create/edit/delete/approve/export يجب أن تُحمى:
  - إذا لم يملك المستخدم permission key المناسب (effective) -> يمنع/يرفض/redirect مناسب.
- ممنوع وجود “ثغرات” حيث يختفي زر في الواجهة لكن يمكن تنفيذ العملية عبر URL مباشر.
- يجب مراجعة أهم modules (على الأقل):
  - schedules
  - shift reports
  - dogs / employees / projects (حسب وجودها)
  - accounts/user management
  والتأكد أن الحماية موجودة في backend.

4) ضمان أن Overrides تؤثر على الوصول “لشاشات أخرى” كما طلبنا
- المدير العام يجب أن يستطيع منح مستخدم (PM أو Handler) صلاحية شاشة/قسم لم يكن ضمن baseline:
  مثال: منح Handler صلاحية dogs.view أو reports.export إلخ.
- بعد منح هذه الصلاحية:
  - تظهر الروابط/القائمة الخاصة بها للمستخدم
  - يستطيع فتح الشاشة فعليًا (Backend يسمح)
- بعد عمل Revoke:
  - تختفي الروابط/الأزرار
  - Backend يمنع الوصول حتى لو استخدم URL مباشر

5) معايير القبول (Acceptance Criteria) — لا تعتبر المهمة مكتملة بدونها:
اختبار 1 (UI):
- امنح لمستخدم Handler صلاحية “مشاهدة شاشة إضافية” ليست ضمن baseline.
- سجّل دخوله -> يجب أن تظهر في القائمة ويمكن فتحها.
- قم بعمل Revoke -> تختفي ويُمنع الوصول.

اختبار 2 (Backend):
- نفس المستخدم بعد revoke يحاول فتح URL مباشر للشاشة -> يجب أن يُمنع.

اختبار 3 (Baseline vs Overrides):
- Permission على وضع “Default” يجب أن يتبع baseline بدقة.
- Grant يضيف فوق baseline.
- Revoke يحجب حتى لو baseline يسمح.

اختبار 4 (Admin):
- GENERAL_ADMIN لا يتأثر بالـ revoke الخاص به (إلا إذا نظامكم يقبل ذلك صراحة). المهم: لا تنكسر صلاحياته العامة.

اختبار 5 (No Partial Areas):
- لا يوجد أي جزء في UI ما زال يظهر/يختفي بناءً على role فقط بدون effective permissions.

المخرجات المطلوبة منك:
- نفّذ هذا بالكامل.
- ثم أعطني في الرد:
  1) شرح مختصر: كيف تُحسب effective permissions الآن
  2) أين تم تطبيقها في UI (بشكل عام: navigation/buttons)
  3) أين تم تطبيقها في backend (decorators/guards)
  4) خطوات اختبار يدوية مرقمة (1→5) كما أعلاه
