الغرض: مراجعة المشروع لتنظيف أي بقايا لا حاجة لها بعد إزالة نظام الحضور التقليدي، ثم إصلاح مشكلة عدم ظهور جدول اليوم للسائس في لوحة التحكم.

المهام المطلوب تنفيذها:

التأكد من حذف نظام الحضور التقليدي بالكامل

راجع الملفات المتبقية مثل models_attendance_reporting.py, attendance_service.py, وقوالب الحضور (projects/attendance_add.html, projects/attendance_list.html، وغيرها) ومسارات الحضور داخل main.py.

إذا كانت هذه الملفات أو الدوال لم تعد تُستدعى من أي جزء في التطبيق بعد الانتقال إلى نظام الجدولة اليومية، قم بإزالتها أو تعطيلها نهائيًا، وتحقق من عدم وجود تبعيات تُحيل إليها.

نظّف أي مسارات، أو قوالب، أو خدمات لم تعد مستخدمة بسبب هذا الإزالة، وأزل استدعاء الـ Blueprint القديم الخاص بالحضور إن وجد.

إصلاح عرض جدول اليوم في لوحة تحكم السائس

حاليًا، عندما ينشئ مسؤول المشروع جدولًا لليوم التالي، يصل إشعار للسائس لكنه لا يرى الجدول في قسم “جدول اليوم” بلوحة تحكمه؛ بل يبقى هذا القسم فارغًا.

افحص دالة DailyScheduleService.get_handler_schedule_for_date والدالة dashboard في handler_routes.py للتأكد من أن التاريخ المستخدم يتوافق مع تاريخ الجدول الذي تم إنشاؤه. تأكد من أن الجدول الذي يُنشأ الساعة 23:00 لليوم التالي يظهر فعليًا في اليوم التالي.

إذا كانت المشكلة في المنطقة الزمنية أو في مقارنة التاريخ (على سبيل المثال، استخدام date.today() بدلاً من التاريخ المستهدف من الإشعار)، قم بتعديل المنطق ليتعرف على جدول الغد عند بداية اليوم.

تأكد من إرفاق عناصر الجدول في المتغير today_schedule المرسل إلى القالب، بحيث تُملأ الجدول في handler/dashboard.html ويظهر تحت عنوان “جدول اليوم”، وليس ضمن الإشعارات فقط.

اختبر السيناريو:

يقوم مسؤول المشروع بإنشاء جدول لليوم التالي ويعين السائس والكلب والموقع والوردية.

عند دخول السائس في اليوم التالي، يجب أن يرى الجدول في قسم “جدول اليوم” مع تفاصيل الوردية والموقع والكلب.

يجب أن يكون الزر “إنشاء تقرير الفترة” ظاهرًا وقابلًا للاستخدام مباشرة من هذا الجدول، مع منع إنشاء التقرير قبل نهاية الوردية.

إزالة أي تداخل بين الإشعارات والجدول

استمر في إرسال إشعار للسائس عند إنشاء الجدول (ليُعلم بوجود جدول جديد)، لكن لا تعتمد على الإشعارات لعرض تفاصيل الجدول.

تأكد من أن NotificationService لا يعيد الجدول كجزء من حمولة الإشعار (payload) إلا في حالة العرض المختصر، وأن التفاصيل تُجلب من قاعدة البيانات عند فتح صفحة لوحة التحكم.

اختبارات نهائية

بعد إجراء التعديلات، اختبر التحضير في السيناريو الطبيعي للتأكد من عدم وجود أخطاء في عرض الجدول، وللتأكد من عدم ظهور صفحات الحضور التقليدية في أي مكان آخر.

تأكد من عدم وجود مسارات أو روابط معطلة في التطبيق نتيجة إزالة نظام الحضور التقليدي، وأن جميع الصفحات تعمل بسلاسة.