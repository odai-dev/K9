====================================================================================================
تقرير شامل: جميع الشروط المعتمدة على الدور (Role-Based Checks)
====================================================================================================

إجمالي عدد الشروط المكتشفة: 224
تاريخ الإنشاء: 2025-11-15 21:48:25

====================================================================================================


----------------------------------------------------------------------------------------------------
الملف: k9/api/api_breeding_training_activity.py
----------------------------------------------------------------------------------------------------

السطر    40:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   193:         if current_user.role == UserRole.GENERAL_ADMIN:
السطر   391:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   440:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   540:         if current_user.role == UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/api/api_cleaning.py
----------------------------------------------------------------------------------------------------

السطر    64:         if current_user.role == UserRole.GENERAL_ADMIN:
السطر   277:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   353:         if current_user.role == UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/api/api_deworming.py
----------------------------------------------------------------------------------------------------

السطر    37:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   128:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   204:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   241:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   314:         if current_user.role == UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/api/api_excretion.py
----------------------------------------------------------------------------------------------------

السطر    33:         if current_user.role == UserRole.GENERAL_ADMIN:
السطر   246:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   320:         if current_user.role == UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/api/api_routes.py
----------------------------------------------------------------------------------------------------

السطر    58:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   294:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   333:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   373:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   492:         if current_user.role == UserRole.PROJECT_MANAGER and project_id:
السطر   561:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   623:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   665:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   789:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   878:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر   961:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر  1003:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر  1111:         if current_user.role == UserRole.PROJECT_MANAGER and project_id_value and project_id_value.strip():
السطر  1203:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر  1273:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر  1329:         if current_user.role == UserRole.PROJECT_MANAGER:
السطر  1376:         if current_user.role == UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/account_management_routes.py
----------------------------------------------------------------------------------------------------

السطر   223:     if user.role == UserRole.GENERAL_ADMIN and User.query.filter_by(role=UserRole.GENERAL_ADMIN, active=True).count() == 1 and user.active:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/admin_routes.py
----------------------------------------------------------------------------------------------------

السطر   252:     if user.role != UserRole.PROJECT_MANAGER:
السطر   437:     if user.role != UserRole.PROJECT_MANAGER:
السطر   461:     if user.role != UserRole.PROJECT_MANAGER:
السطر   574:     if user.role != UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/auth.py
----------------------------------------------------------------------------------------------------

السطر   120:         if user.role == UserRole.GENERAL_ADMIN:
السطر   251:     if current_user.role != UserRole.GENERAL_ADMIN:
السطر   304:     if current_user.role != UserRole.GENERAL_ADMIN:
السطر   336:     if current_user.role != UserRole.GENERAL_ADMIN:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/handler_routes.py
----------------------------------------------------------------------------------------------------

السطر    30:         if not current_user.is_authenticated or current_user.role != UserRole.HANDLER:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/main.py
----------------------------------------------------------------------------------------------------

السطر    49:     if current_user.role == UserRole.HANDLER:
السطر    53:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر    59:     if current_user.role == UserRole.PROJECT_MANAGER:
السطر    65:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر   118:     if current_user.role == UserRole.PROJECT_MANAGER:
السطر   150:             assigned_to_user_id = current_user.id if current_user.role == UserRole.PROJECT_MANAGER else None
السطر   201:     if current_user.role == UserRole.PROJECT_MANAGER:
السطر   213:     elif not is_admin(current_user):
السطر   240:     if current_user.role != UserRole.GENERAL_ADMIN and dog.assigned_to_user_id != current_user.id:
السطر   310:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر   341:             assigned_to_user_id = current_user.id if current_user.role == UserRole.PROJECT_MANAGER else None
السطر   523:     if current_user.role != UserRole.GENERAL_ADMIN and employee.assigned_to_user_id != current_user.id:
السطر   576:     if current_user.role != UserRole.GENERAL_ADMIN and employee.assigned_to_user_id != current_user.id:
السطر   679:     vets = [e for e in scoped_employees if e.role == EmployeeRole.VET and e.is_active] if scoped_employees else []
السطر   691:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر   749:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  1255:     if not is_admin(current_user):
السطر  1270:     if not is_admin(current_user):
السطر  1285:     if not is_admin(current_user):
السطر  1300:     if not is_admin(current_user):
السطر  1315:     if not is_admin(current_user):
السطر  1330:     if not is_admin(current_user):
السطر  1342:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  1362:     if not is_admin(current_user):
السطر  1401:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  1437:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  1503:             manager_id = current_user.id if current_user.role == UserRole.PROJECT_MANAGER else request.form.get('manager_id')
السطر  1532:                 if employee and employee.role == EmployeeRole.PROJECT_MANAGER:
السطر  1562:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  1591:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  1613:             if current_user.role == UserRole.GENERAL_ADMIN:
السطر  1617:                     if employee and employee.role == EmployeeRole.PROJECT_MANAGER:
السطر  1643:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  1680:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  1770:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  1786:             if employee and employee.role == EmployeeRole.PROJECT_MANAGER:
السطر  1828:     if not is_admin(current_user):
السطر  1883:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  1924:     if not is_admin(current_user):
السطر  1934:             if manager and manager.role == EmployeeRole.PROJECT_MANAGER:
السطر  1987:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2044:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2096:                     if employee and employee.role == EmployeeRole.PROJECT_MANAGER:
السطر  2121:                 if manager and manager.role == EmployeeRole.PROJECT_MANAGER:
السطر  2162:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2199:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2234:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2259:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2307:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2354:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2379:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2431:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2456:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  2499:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3062:     if not is_admin(current_user):
السطر  3088:     if not is_admin(current_user):
السطر  3142:     if not is_admin(current_user):
السطر  3172:     if not is_admin(current_user):
السطر  3245:     if not is_admin(current_user):
السطر  3300:     if not is_admin(current_user):
السطر  3326:     if not is_admin(current_user):
السطر  3357:     if not is_admin(current_user):
السطر  3402:     if not is_admin(current_user):
السطر  3488:     if current_user.role == UserRole.PROJECT_MANAGER:
السطر  3517:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3563:     if current_user.role == UserRole.PROJECT_MANAGER:
السطر  3570:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3623:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3663:     if current_user.role == UserRole.PROJECT_MANAGER:
السطر  3670:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3723:         if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3838:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3872:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3913:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3956:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3974:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  3996:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4020:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4064:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4112:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4363:         if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4394:         if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4422:         if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4472:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  4501:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  4558:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  4613:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  4650:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  4659:         if current_user.role != UserRole.GENERAL_ADMIN:
السطر  4699:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر  4720:     if not has_access and current_user.role == UserRole.PROJECT_MANAGER:
السطر  4761:     if current_user.role != UserRole.GENERAL_ADMIN:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/pm_daily_routes.py
----------------------------------------------------------------------------------------------------

السطر    34:     if current_user.role == UserRole.GENERAL_ADMIN:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/pm_routes.py
----------------------------------------------------------------------------------------------------

السطر    57:     if current_user.role == UserRole.GENERAL_ADMIN and session.get('admin_mode') == 'general_admin':
السطر    90:         if current_user.role == UserRole.GENERAL_ADMIN and session.get('admin_mode') == 'general_admin':
السطر   225:     if current_user.role == UserRole.GENERAL_ADMIN and session.get('admin_mode') == 'general_admin':
السطر   439:         if emp.role == EmployeeRole.HANDLER:
السطر   441:             user_account = emp.user_account if emp.user_account and emp.user_account.role == UserRole.HANDLER else None

----------------------------------------------------------------------------------------------------
الملف: k9/routes/supervisor_routes.py
----------------------------------------------------------------------------------------------------

السطر    38:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر    60:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر   145:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر   148:     elif current_user.role == UserRole.PROJECT_MANAGER:
السطر   186:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   204:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   223:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   242:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   276:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   414:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   435:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   447:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر   454:     if current_user.role == UserRole.GENERAL_ADMIN:
السطر   479:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   502:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   542:     if current_user.role == UserRole.PROJECT_MANAGER and current_user.project_id:
السطر   585:     if current_user.role != UserRole.PROJECT_MANAGER:
السطر   633:     if current_user.role != UserRole.PROJECT_MANAGER:
السطر   661:     if current_user.role != UserRole.PROJECT_MANAGER:
السطر   687:     if current_user.role != UserRole.PROJECT_MANAGER:
السطر   719:     if current_user.role != UserRole.PROJECT_MANAGER:
السطر   751:     if current_user.role != UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/routes/task_routes.py
----------------------------------------------------------------------------------------------------

السطر   112:     if current_user.role == UserRole.GENERAL_ADMIN:

----------------------------------------------------------------------------------------------------
الملف: k9/services/pm_daily_services.py
----------------------------------------------------------------------------------------------------

السطر    44:     if user.role == UserRole.PROJECT_MANAGER:

----------------------------------------------------------------------------------------------------
الملف: k9/services/report_review_service.py
----------------------------------------------------------------------------------------------------

السطر    46:         if not user or user.role != UserRole.PROJECT_MANAGER:
السطر   438:         if not admin_user or admin_user.role != UserRole.GENERAL_ADMIN:
السطر   454:         if not admin_user or admin_user.role != UserRole.GENERAL_ADMIN:

----------------------------------------------------------------------------------------------------
الملف: k9/utils/permission_decorators.py
----------------------------------------------------------------------------------------------------

السطر    29:             if _is_admin_mode(current_user):
السطر    70:             if _is_admin_mode(current_user):
السطر   108:         if _is_admin_mode(current_user):
السطر   138:         if current_user.role != UserRole.GENERAL_ADMIN:
السطر   182:             if _is_admin_mode(current_user):
السطر   233:             if _is_admin_mode(current_user):
السطر   237:             if current_user.role == role:
السطر   289:             if _is_admin_mode(current_user):
السطر   329:             if _is_admin_mode(current_user):
السطر   380:             if _is_admin_mode(current_user):

----------------------------------------------------------------------------------------------------
الملف: k9/utils/permission_utils.py
----------------------------------------------------------------------------------------------------

السطر    23:     if user.role != UserRole.GENERAL_ADMIN and user.role.value != "GENERAL_ADMIN":
السطر    34:     if user.role == UserRole.PROJECT_MANAGER or user.role.value == "PROJECT_MANAGER":
السطر    37:     if user.role == UserRole.GENERAL_ADMIN or user.role.value == "GENERAL_ADMIN":
السطر   284:     if _is_admin_mode(user):
السطر   357:     if _is_admin_mode(user):
السطر   411:     if _is_admin_mode(user):
السطر   437:     if _is_admin_mode(user):
السطر   463:     if _is_admin_mode(user):
السطر   490:     if _is_admin_mode(user):
السطر   831:     if _is_admin_mode(user):
السطر   879:     if user.role == UserRole.GENERAL_ADMIN:
السطر   887:     return permissions if user.role == UserRole.GENERAL_ADMIN else []
السطر   891:     if user.role == UserRole.GENERAL_ADMIN:

----------------------------------------------------------------------------------------------------
الملف: k9/utils/pm_scoping.py
----------------------------------------------------------------------------------------------------

السطر    32:     if user.role == UserRole.GENERAL_ADMIN:
السطر    36:     elif user.role != UserRole.PROJECT_MANAGER:
السطر    65:     if user.role == UserRole.PROJECT_MANAGER:
السطر    69:     if user.role == UserRole.GENERAL_ADMIN:
السطر    93:     if user.role != UserRole.GENERAL_ADMIN:
السطر   111:     if is_admin(user):
السطر   143:     if is_admin(user):
السطر   170:     if is_admin(user):
السطر   189:     if is_admin(user):
السطر   237:     if is_admin(user):
السطر   272:     if is_admin(user):
السطر   291:     if is_admin(user):
السطر   310:     if is_admin(user):
السطر   379:     if is_admin(user):
السطر   412:     if is_admin(user):

----------------------------------------------------------------------------------------------------
الملف: k9/utils/template_utils.py
----------------------------------------------------------------------------------------------------

السطر    20:     if _is_admin_mode(current_user):
السطر    44:     if _is_admin_mode(current_user):

----------------------------------------------------------------------------------------------------
الملف: k9/utils/utils.py
----------------------------------------------------------------------------------------------------

السطر   787:     if _is_admin_mode(user):
السطر   843:     if user.role == UserRole.GENERAL_ADMIN:
السطر   856:     if user.role == UserRole.PROJECT_MANAGER:
السطر   918:     if user.role == UserRole.GENERAL_ADMIN:
السطر   920:     elif user.role == UserRole.PROJECT_MANAGER:
السطر   969:     if user.role == UserRole.GENERAL_ADMIN:
السطر   971:     elif user.role == UserRole.PROJECT_MANAGER:
السطر   983:     if user.role == UserRole.GENERAL_ADMIN:
السطر   985:     elif user.role == UserRole.PROJECT_MANAGER:
السطر  1046:     if employee and employee.role == EmployeeRole.PROJECT_MANAGER:
السطر  1054:     if user.role == UserRole.GENERAL_ADMIN:
السطر  1056:     elif user.role == UserRole.PROJECT_MANAGER:
السطر  1076:     if user.role == UserRole.GENERAL_ADMIN:
السطر  1078:     elif user.role == UserRole.PROJECT_MANAGER:
السطر  1143:         if employee and employee.role == EmployeeRole.PROJECT_MANAGER:
السطر  1323:     if user.role == UserRole.HANDLER:

====================================================================================================
نهاية التقرير
====================================================================================================
