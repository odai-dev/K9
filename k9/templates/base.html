<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}نظام إدارة عمليات الكلاب البوليسية{% endblock %}</title>
    
    <!-- Bootstrap 5 RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    
    <!-- Arabic Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    {% if current_user.is_authenticated %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid px-3">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main.dashboard') }}">
                <i class="fas fa-shield-alt me-2 fs-4"></i>
                <span class="fw-bold d-none d-lg-inline">نظام إدارة الكلاب البوليسية</span>
                <span class="fw-bold d-lg-none">K9</span>
            </a>
            
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link px-3 py-2 rounded-pill" href="{{ url_for('main.dashboard') }}">
                            <i class="fas fa-home me-1"></i>الرئيسية
                        </a>
                    </li>
                    
                    {% set permissions = get_user_permissions(current_user) %}
                    
                    {% if permissions.dogs or permissions.employees %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle px-3 py-2 rounded-pill" href="#" id="resourcesDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-users me-1"></i>الموارد
                        </a>
                        <ul class="dropdown-menu shadow">
                            {% if permissions.dogs %}
                            <li><h6 class="dropdown-header">الكلاب</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.dogs_list') }}"><i class="fas fa-dog me-2"></i>قائمة الكلاب</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.dogs_add') }}"><i class="fas fa-plus me-2"></i>إضافة كلب</a></li>
                            {% endif %}
                            {% if permissions.dogs and permissions.employees %}
                            <li><hr class="dropdown-divider"></li>
                            {% endif %}
                            {% if permissions.employees %}
                            <li><h6 class="dropdown-header">الموظفين</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.employees_list') }}"><i class="fas fa-users me-2"></i>قائمة الموظفين</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.employees_add') }}"><i class="fas fa-user-plus me-2"></i>إضافة موظف</a></li>
                            {% endif %}
                        </ul>
                    </li>
                    {% endif %}
                    
                    {% if permissions.training %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle px-3 py-2 rounded-pill" href="#" id="breedingDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-leaf me-1"></i>التربية
                        </a>
                        <ul class="dropdown-menu shadow">
                            <li><h6 class="dropdown-header">التدريب</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.training_list') }}"><i class="fas fa-clipboard me-2"></i>جلسات التدريب</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.training_add') }}"><i class="fas fa-plus me-2"></i>إضافة جلسة</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">الرعاية اليومية</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.breeding_feeding_log') }}"><i class="fas fa-utensils me-2"></i>التغذية — السجل اليومي</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.breeding_checkup') }}"><i class="fas fa-stethoscope me-2"></i>الفحص الظاهري اليومي</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.breeding_excretion') }}"><i class="fas fa-tint me-2"></i>البراز / البول / القيء</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">الرعاية والتدريب</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.breeding_grooming') }}"><i class="fas fa-cut me-2"></i>العناية (الاستحمام والصيانة)</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.breeding_deworming') }}"><i class="fas fa-capsules me-2"></i>جرعة الديدان</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.breeding_training_activity') }}"><i class="fas fa-running me-2"></i>تدريب — أنشطة يومية</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.breeding_cleaning') }}"><i class="fas fa-broom me-2"></i>النظافة (البيئة/القفص)</a></li>
                        </ul>
                    </li>
                    {% endif %}
                    
                    {% if permissions.veterinary %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle px-3 py-2 rounded-pill" href="#" id="vetDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-stethoscope me-1"></i>الطبابة
                        </a>
                        <ul class="dropdown-menu shadow">
                            <li><a class="dropdown-item" href="{{ url_for('main.veterinary_list') }}"><i class="fas fa-notes-medical me-2"></i>الزيارات البيطرية</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.veterinary_add') }}"><i class="fas fa-plus-square me-2"></i>إضافة زيارة</a></li>
                        </ul>
                    </li>
                    {% endif %}
                    
                    {% if permissions.production %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle px-3 py-2 rounded-pill" href="#" id="productionDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-heart me-1"></i>الإنتاج
                        </a>
                        <ul class="dropdown-menu shadow">
                            <li><h6 class="dropdown-header">إدارة الإنتاج</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.production_list') }}"><i class="fas fa-tachometer-alt me-2"></i>لوحة الإنتاج</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">دورة الحياة</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.maturity_list') }}"><i class="fas fa-seedling me-2"></i>البلوغ</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.heat_cycles_list') }}"><i class="fas fa-calendar-alt me-2"></i>الدورة</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.mating_list') }}"><i class="fas fa-heart me-2"></i>التزاوج</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.pregnancy_list') }}"><i class="fas fa-baby me-2"></i>الحمل</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.delivery_list') }}"><i class="fas fa-baby-carriage me-2"></i>الولادة</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">الجراء</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.puppies_list') }}"><i class="fas fa-paw me-2"></i>الجراء</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.puppy_training_list') }}"><i class="fas fa-graduation-cap me-2"></i>تدريب الجراء</a></li>
                        </ul>
                    </li>
                    {% endif %}
                    
                    {% if permissions.projects %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle px-3 py-2 rounded-pill" href="#" id="projectsDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-project-diagram me-1"></i>المشاريع
                        </a>
                        <ul class="dropdown-menu shadow">
                            <li><a class="dropdown-item" href="{{ url_for('main.projects') }}"><i class="fas fa-folder me-2"></i>المشاريع</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.project_add') }}"><i class="fas fa-plus-circle me-2"></i>إضافة مشروع</a></li>
                        </ul>
                    </li>
                    {% endif %}
                    
                    
                    {% if current_user.role.value == 'GENERAL_ADMIN' %}
                    <li class="nav-item">
                        <a class="nav-link px-3 py-2 rounded-pill" href="{{ url_for('main.unified_attendance') }}">
                            <i class="fas fa-calendar-check me-1"></i>الحضور
                        </a>
                    </li>
                    {% endif %}
                    
                    {% if permissions.reports %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle px-3 py-2 rounded-pill" href="#" id="reportsDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-chart-bar me-1"></i>التقارير
                        </a>
                        <ul class="dropdown-menu shadow">
                            <li><h6 class="dropdown-header">تقارير التدريب</h6></li>
                            <li><a class="dropdown-item" href="/reports/training/trainer-daily"><i class="fas fa-dumbbell me-2"></i>التقرير اليومي للمدرب</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">تقارير الحضور</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('reports_attendance_ui.daily_sheet') }}"><i class="fas fa-calendar-check me-2"></i>كشف التحضير اليومي</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('reports_attendance_pm_daily_ui.pm_daily') }}"><i class="fas fa-file-alt me-2"></i>التقرير اليومي لمسؤول المشروع</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">تقارير أخرى</h6></li>
                            <li><a class="dropdown-item" href="{{ url_for('main.reports_index') }}"><i class="fas fa-chart-line me-2"></i>التقارير العامة</a></li>
                        </ul>
                    </li>
                    {% endif %}
                </ul>
                
                <!-- Search -->
                <div class="d-none d-lg-flex me-3 align-items-center">
                    <div class="position-relative">
                        <input class="form-control rounded-pill pe-4" type="search" placeholder="بحث سريع..." id="globalSearch" style="width: 250px;">
                        <i class="fas fa-search position-absolute top-50 end-0 translate-middle-y me-3 text-muted"></i>
                    </div>
                </div>
                
                <!-- Mobile Search Button -->
                <div class="d-lg-none me-2">
                    <button class="btn btn-outline-light btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#mobileSearchModal">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                

                
                <!-- User Menu for Desktop -->
                <ul class="navbar-nav d-none d-lg-flex">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center px-3 py-2" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <div class="rounded-circle bg-light text-primary d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
                                <i class="fas fa-user"></i>
                            </div>
                            <span class="fw-semibold">{{ current_user.full_name }}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow">
                            <li><h6 class="dropdown-header">الحساب الشخصي</h6></li>
                            {% if current_user.role.value == 'GENERAL_ADMIN' %}
                            <li><a class="dropdown-item" href="{{ url_for('main.admin_panel') }}"><i class="fas fa-user-shield me-2"></i>لوحة التحكم</a></li>
                            <li><hr class="dropdown-divider"></li>
                            {% endif %}
                            <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt me-2"></i>تسجيل الخروج</a></li>
                        </ul>
                    </li>
                </ul>
                
                <!-- Mobile User Menu -->
                <ul class="navbar-nav d-lg-none">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="mobileUserDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow">
                            <li><h6 class="dropdown-header">{{ current_user.full_name }}</h6></li>
                            {% if current_user.role.value == 'GENERAL_ADMIN' %}
                            <li><a class="dropdown-item" href="{{ url_for('main.admin_panel') }}"><i class="fas fa-user-shield me-2"></i>لوحة التحكم</a></li>
                            <li><hr class="dropdown-divider"></li>
                            {% endif %}
                            <li><a class="dropdown-item text-danger" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt me-2"></i>تسجيل الخروج</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    {% endif %}
    
    <!-- Flash Messages -->
    <div class="container-fluid mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    
    <!-- Main Content -->
    <main class="container-fluid py-4" style="margin-top: 80px; min-height: calc(100vh - 80px);">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Search Results Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">نتائج البحث</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="searchResults"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Search Modal -->
    <div class="modal fade" id="mobileSearchModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">البحث</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="position-relative">
                        <input class="form-control pe-4" type="search" placeholder="ابحث عن الكلاب، الموظفين، المشاريع..." id="mobileGlobalSearch">
                        <i class="fas fa-search position-absolute top-50 end-0 translate-middle-y me-3 text-muted"></i>
                    </div>
                    <div id="mobileSearchResults" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- jQuery removed - using vanilla JavaScript -->
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    {% block scripts %}{% endblock %}
    {% block extra_js %}{% endblock %}
</body>
</html>
