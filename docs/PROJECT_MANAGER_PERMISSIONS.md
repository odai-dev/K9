# صلاحيات مدير المشروع (PROJECT_MANAGER)

## التحديث الأخير: 27 أكتوبر 2025

### الصلاحيات الافتراضية لمدير المشروع

تم تحديث نظام الصلاحيات ليمنح مدير المشروع (PROJECT_MANAGER) صلاحيات كاملة افتراضياً على الأقسام التالية:

#### ✅ الأقسام المتاحة بالكامل:

1. **المشاريع (Projects)** ✓
   - عرض قائمة المشاريع
   - إضافة مشروع جديد
   - تعديل بيانات المشاريع
   - إدارة تعيينات المشروع
   - عرض لوحة تحكم المشروع

2. **الكلاب (Dogs)** ✓
   - عرض قائمة الكلاب
   - إضافة كلب جديد
   - تعديل بيانات الكلاب
   - عرض تفاصيل الكلب

3. **الموظفين (Employees)** ✓
   - عرض قائمة الموظفين
   - إضافة موظف جديد
   - تعديل بيانات الموظفين

4. **التدريب (Training)** ✓
   - عرض جلسات التدريب
   - إضافة جلسة تدريب
   - تعديل بيانات التدريب

5. **الطبابة (Veterinary)** ✓
   - عرض الزيارات البيطرية
   - إضافة زيارة بيطرية

6. **الإنتاج (Production)** ✓
   - عرض سجلات الإنتاج
   - إدارة دورة الحياة

7. **التقارير (Reports)** ✓
   - عرض جميع أنواع التقارير
   - تصدير التقارير بصيغ مختلفة
   - الوصول إلى مركز التقارير

8. **الإدارة (Management)** ✓
   - إرسال المهام للسائسين
   - عرض تقارير السائسين
   - إدارة الجداول اليومية
   - عرض الإشعارات

#### ❌ الأقسام المحدودة:

1. **الحضور (Attendance)** ✗
   - متاح فقط للمدير العام (GENERAL_ADMIN)

2. **لوحة التحكم الإدارية (Admin Dashboard)** ✗
   - متاح فقط للمدير العام (GENERAL_ADMIN)
   - إدارة المستخدمين
   - النسخ الاحتياطي

### كيفية العمل

#### الصلاحيات الافتراضية
- عند إنشاء حساب مدير مشروع جديد، يحصل تلقائياً على جميع الصلاحيات المذكورة أعلاه
- لا حاجة لإضافة صلاحيات يدوياً عبر جدول SubPermission

#### الصلاحيات المخصصة
- يمكن للمدير العام تخصيص صلاحيات إضافية عبر نظام SubPermission
- يمكن تقييد بعض الصلاحيات إذا لزم الأمر

### التغييرات التقنية

تم تعديل الدالة `get_user_permissions` في الملف `k9/utils/utils.py` لتعطي صلاحيات افتراضية كاملة لمدير المشروع:

```python
else:  # PROJECT_MANAGER
    permissions = {
        'dogs': True,           # يمكنه عرض وإدارة الكلاب
        'employees': True,      # يمكنه عرض وإدارة الموظفين
        'training': True,       # يمكنه عرض وإدارة التدريب
        'veterinary': True,     # يمكنه عرض السجلات البيطرية
        'production': True,     # يمكنه عرض سجلات الإنتاج
        'projects': True,       # يمكنه عرض وإدارة المشاريع
        'attendance': False,    # وصول محدود (للمدير العام فقط)
        'reports': True,        # يمكنه عرض وتصدير جميع التقارير
        'admin': False          # لا يوجد وصول إداري
    }
```

### الفرق بين GENERAL_ADMIN و PROJECT_MANAGER

| الميزة | GENERAL_ADMIN | PROJECT_MANAGER |
|--------|---------------|-----------------|
| إدارة جميع المشاريع | ✓ | ✓ |
| إدارة الكلاب والموظفين | ✓ | ✓ |
| التدريب والطبابة | ✓ | ✓ |
| التقارير والإحصائيات | ✓ | ✓ |
| إدارة الحضور | ✓ | ✗ |
| إدارة المستخدمين | ✓ | ✗ |
| النسخ الاحتياطي | ✓ | ✗ |
| إعدادات النظام | ✓ | ✗ |

### ملاحظات مهمة

1. **تصفية البيانات**: على الرغم من أن مدير المشروع يمكنه الوصول إلى هذه الأقسام، إلا أن البيانات المعروضة قد تكون مصفاة بناءً على المشاريع المخصصة له.

2. **التحديث التلقائي**: التغييرات نافذة مباشرة - لا حاجة لإعادة تشغيل النظام.

3. **التوافق مع الإصدارات السابقة**: النظام يدعم كلاً من الصلاحيات الافتراضية والمخصصة عبر SubPermission.
